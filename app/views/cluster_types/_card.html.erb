<% cluster_type = card %>

<div class="cluster-type-card">
  <div class="card-divider">
    <h4><%= cluster_type.name %></h4>
  </div>
  <div class="card-section">
    <p><%= cluster_type.description %></p>
  </div>
  <div class="card-section">
    <% disabled = true %>
    <% if team %>
      <% cluster = Cluster.new(cluster_type: cluster_type, team: team) %>
      <% if current_user.can?(:create, cluster) %>
        <% disabled = false %>
        <%  title = "" %>
      <% else %>
        <% title =  if Team.meets_cluster_credit_requirement.where(id: team.id).exists?
                      "You do not have permission to create clusters"
                    else
                      "Insufficient credits. Your chosen team must have at least #{Rails.application.config.cluster_credit_requirement} credits to create a cluster"
                    end
        %>
      <% end %>
    <% else %>
      <% title = if !current_user.can?(:create, Cluster)
           "You do not have permission to create a cluster"
         elsif !available_teams
           "Unable to create a cluster - you must be admin for a team with at least #{Rails.application.config.cluster_credit_requirement} credits to create a cluster"
         else
           "Please select a team"
         end
      %>
    <% end %>
    <%= link_to "Select", disabled ? "#" : new_cluster_type_cluster_path(cluster_type, team_id: team&.id),
                { class: "cluster-type-link #{"disabled-cluster-link" if disabled}", title: title,
                data: { base_target_url: new_cluster_type_cluster_path(cluster_type) } } %>
  </div>
</div>
