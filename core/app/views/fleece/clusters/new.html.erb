<% set_title 'Configure cluster' -%>
<% content_for(:side_content) do %>
  <%= render 'actions' %>
<% end %>

<p>Configure details for cluster <strong><%= @cluster_type.name %></strong></p>
<p><%= @cluster_type.description %></p>

<%= form_for(@cluster, url: fleece_cluster_type_clusters_path(@cluster_type)) do |f| %>
  <% if @cluster.errors.any? %>
    <div id="error_explanation">
      <h2>There are <%= pluralize(@cluster.errors.count, "error") %>:</h2>
   
      <ul>
      <% @cluster.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="formItem">
    <%= f.label :name, "Cluster name", class: 'required_field' %>
    <%= f.text_field :name, autocomplete: :off, required: true %>
  </div>

  <h4>Cluster Parameters</h4>
  <% @cluster.fields.each do |field| %>
    <%= f.fields_for :cluster_params, field do |cluster_param| %>
      <div class="formItem">
        <%= cluster_param.label field.id.to_sym, field.label, class: 'required_field', title: field.description unless field.hidden %>
        <% if field.select_box? %>
          <%= cluster_param.send(field.form_field_type, :value, field.allowed_values, {prompt: true}, field.form_options) %>
        <% else %>
          <%= cluster_param.send(field.form_field_type, :value, field.form_options) %>
        <% end %>
        <% if field.constraints.any? %>
          <div class="constraint-text">
            <%= field.constraint_text %>
          </div>
        <% end %>
      </div>
    <% end %>
  <% end %>

  <%= f.submit 'Create' %>
<% end %>
